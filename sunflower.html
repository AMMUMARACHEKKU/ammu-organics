<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ammu Organics â€” All-in-One Shop</title>
<meta name="description" content="Ammu Organics â€” pure cold pressed oils. Shop Almond, Flax, Mustard, Sunflower, Coconut, Sesame, Groundnut, Castor, Neem."/>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--green:#2f6f4e;--accent:#c19a6b;--bg:#fbf6ef;--muted:#6b6b6b;--card:#fff;--radius:12px}
  *{box-sizing:border-box}
  body{font-family:'Poppins',sans-serif;background:var(--bg);margin:0;color:#163222}
  .wrap{max-width:1200px;margin:20px auto;padding:18px}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:18px}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--green),#6b8a65);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
  nav a{margin-left:12px;text-decoration:none;color:var(--muted);font-weight:600}
  .badge{background:var(--green);color:#fff;padding:6px 10px;border-radius:10px}
  /* grid */
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px}
  .card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 8px 24px rgba(0,0,0,0.06)}
  .prod-img{width:100%;height:180px;object-fit:cover;border-radius:10px}
  .prod-title{font-weight:700;margin:8px 0}
  .small{font-size:13px;color:var(--muted)}
  .btn{background:var(--green);color:white;padding:10px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
  /* layout */
  .main-area{display:grid;grid-template-columns:1fr 380px;gap:18px}
  @media(max-width:1000px){.main-area{grid-template-columns:1fr}}
  /* Product detail */
  .gallery{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 10px 28px rgba(0,0,0,0.05)}
  .media-stage{width:100%;height:360px;border-radius:10px;overflow:hidden;background:#f6f6f6;display:flex;align-items:center;justify-content:center}
  .media-stage img,.media-stage video{width:100%;height:100%;object-fit:cover;display:block}
  .thumbs{display:flex;gap:8px;margin-top:10px;overflow:auto}
  .thumbs button{border:2px solid transparent;padding:0;border-radius:8px;background:transparent;cursor:pointer}
  .thumbs img{width:80px;height:50px;object-fit:cover;border-radius:6px}
  .thumbs button.active{border-color:var(--green)}
  .details{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 10px 24px rgba(0,0,0,0.05)}
  .variants{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .variant{padding:8px 12px;border-radius:10px;border:1px solid #e6e6e6;background:#fff;cursor:pointer}
  .variant.selected{border-color:var(--green);background:rgba(47,111,78,0.06)}
  .qty{display:flex;align-items:center;gap:8px;margin-top:10px}
  .qty button{padding:8px 12px;border-radius:8px;border:1px solid #ddd;background:#fff;cursor:pointer}
  .qty input{width:72px;text-align:center;padding:8px;border-radius:8px;border:1px solid #eee}
  .buy-row{display:flex;gap:10px;margin-top:12px}
  .btn-cart{background:#fff;border:2px solid var(--green);color:var(--green);padding:10px;border-radius:8px;cursor:pointer}
  /* cart panel */
  .cart-panel{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 10px 28px rgba(0,0,0,0.05)}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px solid #f0f0f0;text-align:left}
  .prod-cell{display:flex;gap:8px;align-items:center}
  .prod-cell img{width:68px;height:68px;object-fit:cover;border-radius:8px}
  .qty-inline{display:flex;gap:6px;align-items:center}
  .remove-btn{background:#e74c3c;border:0;color:#fff;padding:6px 8px;border-radius:8px;cursor:pointer}
  .summary{margin-top:12px}
  .summary .line{display:flex;justify-content:space-between;padding:8px 0}
  input,select{width:100%;padding:8px;border-radius:8px;border:1px solid #e6e6e6;margin:6px 0}
  .checkout-btn{background:var(--green);color:#fff;padding:12px;border-radius:8px;border:0;cursor:pointer;width:100%;font-weight:700}
  .whatsapp-btn{background:#25D366;color:#fff;padding:10px;border-radius:8px;border:0;cursor:pointer;width:100%;font-weight:700;margin-top:8px}
  .muted{color:var(--muted)}
  .empty{padding:40px;text-align:center;color:var(--muted)}
  footer{margin-top:24px;padding:14px;text-align:center;color:var(--muted)}
</style>
</head>
<body>

<div class="wrap">

  <!-- HEADER -->
  <header>
    <div style="display:flex;gap:12px;align-items:center">
      <div class="logo">AO</div>
      <div>
        <div style="font-weight:700">Ammu Organics</div>
        <div class="muted" style="font-size:13px">Pure. Natural. Honest.</div>
      </div>
    </div>
    <nav>
      <a href="#" onclick="showSection('shop')">Shop</a>
      <a href="#" onclick="showSection('cart')">Cart <span id="cartCount" class="badge" style="margin-left:8px">0</span></a>
    </nav>
  </header>

  <!-- MAIN: Shop + Right Cart/Checkout -->
  <main style="margin-top:16px">
    <div id="shop" class="section">

      <!-- PRODUCTS GRID -->
      <h2>Our Cold-Pressed Oils</h2>
      <div class="grid" id="productGrid"></div>

      <!-- PRODUCT DETAIL (hidden until clicked) -->
      <div id="productDetail" style="margin-top:18px;display:none">
        <div class="main-area">
          <div>
            <div class="gallery card">
              <div class="media-stage" id="mediaStage"></div>
              <div style="display:flex;justify-content:space-between;margin-top:8px">
                <div class="thumbs" id="thumbs"></div>
              </div>
            </div>
            <div style="margin-top:12px" id="prod-desc" class="card"></div>
          </div>

          <aside class="cart-panel" style="min-width:320px">
            <div class="details">
              <h2 id="productTitle">Product Title</h2>
              <div class="muted" id="productMeta">meta</div>
              <div style="font-size:20px;color:var(--green);font-weight:700;margin-top:8px" id="priceDisplay">â‚¹0.00</div>
              <!-- variants -->
              <div style="margin-top:10px;font-weight:700">Choose size</div>
              <div class="variants" id="variants"></div>

              <!-- qty -->
              <div class="qty" aria-label="Quantity selector">
                <button id="decQty">-</button>
                <input type="number" id="qtyInput" value="1" min="1" aria-label="Order quantity" />
                <button id="incQty">+</button>
              </div>

              <div class="buy-row">
                <button class="btn" id="buyNow">Buy Now (WhatsApp)</button>
                <button class="btn-cart" id="addCart">Add to Cart</button>
              </div>

              <div style="margin-top:10px" class="muted">SKU: <span id="skuDisplay"></span></div>
            </div>
          </aside>
        </div>
      </div>

    </div>

    <!-- CART SECTION -->
    <div id="cart" class="section" style="display:none;margin-top:18px">
      <div style="display:flex;gap:18px;flex-wrap:wrap">
        <div style="flex:2" class="card">
          <h3>Your Cart</h3>
          <div id="cartTableWrap"></div>
        </div>

        <div style="flex:1" class="cart-panel">
          <h3>Cart Totals</h3>
          <div class="summary">
            <div class="line"><span>Subtotal</span><span>â‚¹ <span id="subtotal">0.00</span></span></div>

            <h4 style="margin-top:10px">Shipping</h4>
            <label class="muted">Country</label>
            <select id="country"><option value="India" selected>India</option><option value="Other">Other</option></select>

            <label class="muted">State</label>
            <select id="state"></select>

            <label class="muted">District</label>
            <select id="district"></select>

            <label class="muted">City</label>
            <select id="city"></select>

            <label class="muted">Pincode</label>
            <input id="pincode" placeholder="Pincode" inputmode="numeric">

            <button class="checkout-btn" id="updateShipping">Update Shipping</button>

            <div class="line" style="margin-top:8px"><span>Shipping</span><span>â‚¹ <span id="shipping">0.00</span></span></div>
            <div class="line"><span>GST (5%)</span><span>â‚¹ <span id="gst">0.00</span></span></div>

            <div class="line" style="font-weight:700"><span>Grand Total</span><span>â‚¹ <span id="grandTotal">0.00</span></span></div>

            <button class="checkout-btn" id="checkoutBtn" style="margin-top:10px">Pay with Razorpay</button>
            <button class="whatsapp-btn" id="checkoutWhatsapp">Checkout via WhatsApp</button>

            <div style="margin-top:8px" class="muted">Shipping: Tamil Nadu â‚¹60 (free if â‰¥ â‚¹999), South India â‚¹80, Rest of India â‚¹120.</div>
          </div>
        </div>
      </div>
    </div>

  </main>

  <footer>Â© 2025 Ammu Organics â€” 9629575552 | ammuorganicfood@gmail.com</footer>
</div>

<!-- Razorpay -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
/* ================== DATA ================== */
/* product catalog - images are example placeholders; update with your paths */
const PRODUCTS = [
  { sku:'ALM100', id:'almond', product:'Almond Oil', price:249, images:['images/almond1.jpg','images/almond2.jpg','images/almond3.jpg','images/almond4.jpg','images/almond5.jpg'], video:'videos/almond.mp4', meta:'100% pure cold-pressed sweet almond oil. Rich in Vitamin E.' },
  { sku:'FLX100', id:'flax', product:'Flax Seed Oil', price:399, images:['https://images.unsplash.com/photo-1590080875833-3e5f6cdb0e32?auto=format&fit=crop&w=600&q=80'], video:'', meta:'Rich source of omega-3 fatty acids.' },
  { sku:'MUS500', id:'mustard', product:'Mustard Oil', price:199, images:['https://images.unsplash.com/photo-1621891339221-b3f6acda1e9d?auto=format&fit=crop&w=600&q=80'], video:'', meta:'Traditionally cold-pressed for bold flavor.' },
  { sku:'SUN500', id:'sun', product:'Sunflower Oil', price:180, images:['https://images.unsplash.com/photo-1615484477249-85b4aeb65b16?auto=format&fit=crop&w=600&q=80'], video:'', meta:'Light and nutritious.' },
  { sku:'COC500', id:'coconut', product:'Coconut Oil', price:299, images:['https://images.unsplash.com/photo-1615485290431-7b253a4c09d4?auto=format&fit=crop&w=600&q=80'], video:'', meta:'Cold-pressed coconut oil ideal for hair & skin.' },
  { sku:'SES500', id:'sesame', product:'Sesame Oil', price:220, images:['https://images.unsplash.com/photo-1590080875833-3e5f6cdb0e32?auto=format&fit=crop&w=600&q=80'], video:'', meta:'Traditional gingelly oil.' },
  { sku:'GND500', id:'groundnut', product:'Groundnut Oil', price:240, images:['https://images.unsplash.com/photo-1590080875833-3e5f6cdb0e32?auto=format&fit=crop&w=600&q=80'], video:'', meta:'Great for everyday use.' },
  { sku:'CST100', id:'castor', product:'Castor Oil', price:199, images:['https://images.unsplash.com/photo-1611080626919-8ca294f5b0d6?auto=format&fit=crop&w=600&q=80'], video:'', meta:'Good for hair & skin.' },
  { sku:'NEEM100', id:'neem', product:'Neem Oil', price:249, images:['https://images.unsplash.com/photo-1580910051073-b3f6acda1e9d?auto=format&fit=crop&w=600&q=80'], video:'', meta:'Antibacterial & antifungal.' }
];

/* Shipping rules */
const SHIPPING = { TAMIL_NADU:60, SOUTH:80, REST:120, FREE_TN_THRESHOLD:999 };
const SOUTH_STATES = ['Tamil Nadu','Kerala','Karnataka','Andhra Pradesh','Telangana','Puducherry'];
const GST_RATE = 0.05; // 5%

/* Regions dataset (TN expanded; others minimal). Expand as you like. */
const REGIONS = {
  "Tamil Nadu": {
    "Chennai": ["Chennai","Adyar","T Nagar"],
    "Coimbatore": ["Coimbatore","Peelamedu","Gandhipuram"],
    "Madurai": ["Madurai","Avaniyapuram"],
    "Tirunelveli": ["Tirunelveli","Palayamkottai"]
  },
  "Kerala": { "Thiruvananthapuram": ["Thiruvananthapuram"] },
  "Karnataka": { "Bengaluru": ["Bengaluru"] },
  "Andhra Pradesh": { "Visakhapatnam": ["Visakhapatnam"] },
  "Telangana": { "Hyderabad": ["Hyderabad"] },
  "Maharashtra": { "Mumbai": ["Mumbai"] },
  "Other": { "Other District": ["Other City"] }
};

/* WhatsApp phone (with country code, no +) */
const WHATSAPP_PHONE = '919629575552'; // replace if needed

/* Razorpay key placeholder (client-side). For production use server create-order flow. */
const RAZORPAY_KEY = 'RAZORPAY_KEY_ID_HERE';

/* ================== UTILITIES ================== */
function $(sel){ return document.querySelector(sel); }
function $all(sel){ return Array.from(document.querySelectorAll(sel)); }
function money(v){ return Number(v).toFixed(2); }

/* ================== UI: PRODUCTS GRID ================== */
const productGrid = $('#productGrid');
function renderProductGrid(){
  productGrid.innerHTML = '';
  PRODUCTS.forEach(p=>{
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `
      <img src="${p.images[0]||''}" alt="${p.product}" class="prod-img">
      <div class="prod-title">${p.product}</div>
      <div class="small">${p.meta}</div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
        <div style="font-weight:700;color:var(--green)">â‚¹ ${money(p.price)}</div>
        <div>
          <button class="btn" onclick="openProduct('${p.sku}')">View</button>
        </div>
      </div>`;
    productGrid.appendChild(div);
  });
}

/* ================== PRODUCT DETAIL / GALLERY ================== */
let currentProduct = null;
let gallerySlides = [];
let galleryCurrent = 0;
let galleryTimer = null;

function openProduct(sku){
  const prod = PRODUCTS.find(x=>x.sku===sku);
  if(!prod) return;
  currentProduct = prod;
  // show detail area
  $('#productDetail').style.display = '';
  // media slides
  gallerySlides = [];
  (prod.images || []).forEach(img=> gallerySlides.push({type:'image',src:img}));
  if(prod.video) gallerySlides.push({type:'video',src:prod.video,poster:prod.images && prod.images[0]});
  galleryCurrent = 0;
  renderGallery();
  // product text
  $('#prod-desc').innerHTML = `<h3>About ${prod.product}</h3><p>${prod.meta}</p>`;
  $('#productTitle').innerText = prod.product;
  $('#productMeta').innerText = prod.meta;
  $('#priceDisplay').innerText = 'â‚¹' + money(prod.price);
  $('#skuDisplay').innerText = prod.sku;
  // variants (we'll provide sizes based on SKU pattern; allow editing)
  const variantsWrap = $('#variants');
  variantsWrap.innerHTML = '';
  // default variant set: 100 ml, 200 ml, 500 ml with prices scaling (some presets)
  const variants = [
    { label:'100 ml', sku: prod.sku.replace(/\d+$/,'100'), price: prod.price },
    { label:'200 ml', sku: prod.sku.replace(/\d+$/,'250'), price: Math.round(prod.price*1.8) },
    { label:'500 ml', sku: prod.sku.replace(/\d+$/,'500'), price: Math.round(prod.price*4.5) }
  ];
  variants.forEach((v,i)=>{
    const btn = document.createElement('button');
    btn.className = 'variant' + (i===0 ? ' selected' : '');
    btn.dataset.sku = v.sku;
    btn.dataset.price = v.price;
    btn.textContent = v.label;
    btn.addEventListener('click', ()=> {
      $all('.variant').forEach(b=>b.classList.remove('selected'));
      btn.classList.add('selected');
      $('#priceDisplay').innerText = 'â‚¹' + money(Number(btn.dataset.price));
      $('#skuDisplay').innerText = btn.dataset.sku;
    });
    variantsWrap.appendChild(btn);
  });
  // reset qty
  $('#qtyInput').value = 1;
  scrollToElement('#productDetail');
}

function renderGallery(){
  const mediaStage = $('#mediaStage');
  const thumbs = $('#thumbs');
  mediaStage.innerHTML = '';
  thumbs.innerHTML = '';
  if(!gallerySlides || gallerySlides.length===0){ mediaStage.innerHTML = '<div class="muted">No images</div>'; return; }
  const s = gallerySlides[galleryCurrent];
  if(s.type==='video'){
    const v = document.createElement('video');
    v.src = s.src; v.controls = true; v.playsInline = true; v.preload = 'metadata';
    if(s.poster) v.poster = s.poster;
    mediaStage.appendChild(v);
  } else {
    const img = document.createElement('img');
    img.src = s.src; img.alt = '';
    mediaStage.appendChild(img);
  }
  // thumbs
  gallerySlides.forEach((sl,i)=>{
    const btn = document.createElement('button');
    const img = document.createElement('img');
    img.src = sl.type==='video' ? (sl.poster || sl.src) : sl.src;
    btn.appendChild(img);
    if(i===galleryCurrent) btn.classList.add('active');
    btn.addEventListener('click', ()=> { galleryCurrent = i; renderGallery(); restartGalleryAuto(); });
    thumbs.appendChild(btn);
  });
}
function nextGallery(){ galleryCurrent = (galleryCurrent+1) % gallerySlides.length; renderGallery(); }
function prevGallery(){ galleryCurrent = (galleryCurrent-1 + gallerySlides.length) % gallerySlides.length; renderGallery(); }
function startGalleryAuto(){ stopGalleryAuto(); galleryTimer = setInterval(()=> nextGallery(),4000); }
function stopGalleryAuto(){ if(galleryTimer) clearInterval(galleryTimer); }
function restartGalleryAuto(){ stopGalleryAuto(); startGalleryAuto(); }
startGalleryAuto();

/* ================== CART (localStorage) ================== */
const CART_KEY = 'amu_cart';
function loadCart(){ try{ const c=JSON.parse(localStorage.getItem(CART_KEY)||'[]'); return Array.isArray(c)?c:[] }catch(e){ return [] } }
function saveCart(cart){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); updateCartCount(); }
function getCartTotal(){ const c=loadCart(); return c.reduce((s,it)=> s + (Number(it.price) * Number(it.qty)), 0); }
function updateCartCount(){ const c = loadCart(); $('#cartCount').innerText = c.length; }

/* Add to cart from detail */
$('#addCart').addEventListener('click', ()=>{
  const selected = document.querySelector('.variant.selected');
  const qty = Math.max(1, Number($('#qtyInput').value || 1));
  const item = {
    sku: selected.dataset.sku,
    product: $('#productTitle').innerText,
    variant: selected.innerText,
    price: Number(selected.dataset.price),
    qty: qty,
    img: gallerySlides && gallerySlides[0] ? gallerySlides[0].src : ''
  };
  const cart = loadCart();
  // if same sku+variant exists, increment qty
  const idx = cart.findIndex(x=>x.sku===item.sku && x.variant===item.variant);
  if(idx>-1){ cart[idx].qty = Number(cart[idx].qty) + item.qty; }
  else cart.push(item);
  saveCart(cart);
  alert('Added to cart: ' + item.variant);
});

/* Buy Now -> WhatsApp from detail */
$('#buyNow').addEventListener('click', ()=>{
  const selected = document.querySelector('.variant.selected');
  const qty = Math.max(1, Number($('#qtyInput').value || 1));
  const unitPrice = Number(selected.dataset.price);
  const total = unitPrice * qty;
  const message = `ðŸ›’ *New Order Request*\n\n*Product:* ${$('#productTitle').innerText}\n*Variant:* ${selected.innerText}\n*SKU:* ${selected.dataset.sku}\n*Quantity:* ${qty}\n*Price per unit:* â‚¹${unitPrice}\n*Total:* â‚¹${total}\n\nPlease share Name / Phone / Full address.\n\nThank you â€” Ammu Organics.`;
  const url = `https://wa.me/${WHATSAPP_PHONE}?text=${encodeURIComponent(message)}`;
  window.open(url, '_blank');
});

/* ================== CART PAGE RENDER ================== */
function renderCartTable(){
  const cart = loadCart();
  const wrap = $('#cartTableWrap');
  if(!cart || cart.length===0){
    wrap.innerHTML = '<div class="empty">Your cart is empty â€” go to <a href="#" onclick="showSection(\\'shop\\')">shop</a></div>';
    $('#subtotal').innerText = '0.00';
    $('#shipping').innerText = '0.00';
    $('#gst').innerText = '0.00';
    $('#grandTotal').innerText = '0.00';
    return;
  }
  let html = `<table><thead><tr><th>Product</th><th>Price</th><th>Qty</th><th>Subtotal</th><th></th></tr></thead><tbody>`;
  cart.forEach((it, idx)=>{
    const line = Number(it.price) * Number(it.qty);
    html += `<tr>
      <td><div class="prod-cell"><img src="${it.img||''}"><div><div style="font-weight:700">${it.product}</div><div class="small">${it.variant}</div><div class="small">SKU: ${it.sku}</div></div></div></td>
      <td>â‚¹ ${money(it.price)}</td>
      <td><div class="qty-inline"><button onclick="changeQty(${idx}, -1)">-</button><input style="width:48px;text-align:center" type="number" value="${it.qty}" onchange="manualQty(${idx}, this.value)"><button onclick="changeQty(${idx}, 1)">+</button></div></td>
      <td>â‚¹ ${money(line)}</td>
      <td><button class="remove-btn" onclick="removeItem(${idx})">Remove</button></td>
    </tr>`;
  });
  html += `</tbody></table>`;
  wrap.innerHTML = html;
  $('#subtotal').innerText = money(getCartTotal());
  recalcTotals();
}

/* Qty functions for cart */
function changeQty(i, delta){
  const cart = loadCart();
  cart[i].qty = Math.max(1, Number(cart[i].qty) + delta);
  saveCart(cart);
  renderCartTable();
}
function manualQty(i, v){
  const cart = loadCart(); cart[i].qty = Math.max(1, Number(v||1)); saveCart(cart); renderCartTable();
}
function removeItem(i){
  if(!confirm('Remove item?')) return;
  const cart = loadCart(); cart.splice(i,1); saveCart(cart); renderCartTable();
}

/* ================== SHIPPING & TOTALS ================== */
function populateRegionSelectors(){
  const stateEl = $('#state'), districtEl = $('#district'), cityEl = $('#city');
  stateEl.innerHTML = '';
  Object.keys(REGIONS).forEach(s=>{ const o = document.createElement('option'); o.value = s; o.textContent = s; stateEl.appendChild(o); });
  stateEl.value = 'Tamil Nadu';
  populateDistricts();
}
function populateDistricts(){
  const state = $('#state').value;
  const districtEl = $('#district'); districtEl.innerHTML = '';
  const districts = Object.keys(REGIONS[state]||{});
  districts.forEach(d=>{ const o=document.createElement('option'); o.value=d; o.textContent=d; districtEl.appendChild(o); });
  populateCities();
}
function populateCities(){
  const state = $('#state').value, dist = $('#district').value, cityEl = $('#city');
  cityEl.innerHTML = '';
  const arr = (REGIONS[state] && REGIONS[state][dist]) || ['Other City'];
  arr.forEach(c=>{ const o=document.createElement('option'); o.value=c; o.textContent=c; cityEl.appendChild(o); });
}

function recalcTotals(){
  const subtotal = getCartTotal();
  // shipping
  let ship = 0;
  const country = $('#country').value;
  const state = $('#state').value;
  if(country !== 'India') ship = SHIPPING.REST;
  else {
    if(state === 'Tamil Nadu'){
      ship = (subtotal >= SHIPPING.FREE_TN_THRESHOLD) ? 0 : SHIPPING.TAMIL_NADU;
    } else if(SOUTH_STATES.includes(state)) ship = SHIPPING.SOUTH;
    else ship = SHIPPING.REST;
  }
  // gst
  const gst = (subtotal * GST_RATE);
  const grand = subtotal + gst + ship;
  $('#shipping').innerText = money(ship);
  $('#gst').innerText = money(gst);
  $('#grandTotal').innerText = money(grand);
}

/* Update shipping button */
$('#updateShipping').addEventListener('click', ()=> {
  recalcTotals();
  alert('Shipping updated.');
});

/* Checkout via WhatsApp for cart */
$('#checkoutWhatsapp').addEventListener('click', ()=>{
  const cart = loadCart();
  if(!cart.length){ alert('Cart empty'); return; }
  const subtotal = getCartTotal();
  const shipping = Number($('#shipping').innerText || 0);
  const gst = Number($('#gst').innerText || 0);
  const grand = Number($('#grandTotal').innerText || 0);

  let msg = `ðŸ›’ *New Order from Ammu Organics*%0A%0A`;
  cart.forEach(it=>{
    msg += `â€¢ ${it.product} | ${it.variant} | SKU:${it.sku} | Qty:${it.qty} | â‚¹${money(it.price)}%0A`;
  });
  msg += `%0ASubtotal: â‚¹${money(subtotal)}%0AShipping: â‚¹${money(shipping)}%0AGST: â‚¹${money(gst)}%0ATotal: â‚¹${money(grand)}%0A%0APlease confirm and share Name / Phone / Full Address.`;
  const url = `https://wa.me/${WHATSAPP_PHONE}?text=${msg}`;
  window.open(url,'_blank');
});

/* Checkout via Razorpay (client-side test mode). For production create-order on server. */
$('#checkoutBtn').addEventListener('click', ()=>{
  const cart = loadCart(); if(!cart.length){ alert('Cart empty'); return; }
  const amount = Math.round(Number($('#grandTotal').innerText || 0) * 100); // paise
  const options = {
    key: RAZORPAY_KEY,
    amount: amount,
    currency: 'INR',
    name: 'Ammu Organics',
    description: 'Order Payment',
    handler: function (response){
      alert('Payment Success! Payment ID: ' + response.razorpay_payment_id);
      // clear cart
      saveCart([]);
      renderCartTable();
      showSection('shop');
    },
    prefill: { name:'', email:'', contact:'' },
    theme: { color: '#2f6f4e' }
  };
  const rzp = new Razorpay(options);
  rzp.open();
});

/* ================== NAV & INIT ================== */
function showSection(id){
  $all('.section').forEach(s=>s.style.display='none');
  $('#' + id).style.display = '';
  if(id === 'cart'){ renderCartTable(); populateRegionSelectors(); }
  if(id === 'shop'){ $('#productDetail').style.display = 'none'; }
  scrollToElement('#' + id);
}

function scrollToElement(sel){ try{ document.querySelector(sel).scrollIntoView({behavior:'smooth'}); }catch(e){} }

/* page init */
renderProductGrid();
updateCartCount();
populateRegionSelectors();

/* wire product detail gallery auto-advance sync */
setInterval(()=>{ try{ if(document.querySelector('#productDetail').style.display!=='none' && gallerySlides.length>0){ galleryCurrent=(galleryCurrent+1)%gallerySlides.length; renderGallery(); } }catch(e){} },4000);

</script>
</body>
</html>

